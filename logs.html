<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deletion Logs - Trimark Industries</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="stars"></div>
    <div class="twinkling"></div>
    
    <div class="container">
        <header class="header">
            <div class="logo">
                <div class="logo-image">
                    <img src="ChatGPT_Image_Jul_3_2025_08_34_57_PM.png" alt="Trimark Industries Logo" class="corp-logo">
                </div>
                <div class="logo-text">
                    <h1>TRIMARK INDUSTRIES</h1>
                    <p class="tagline">Forging the Future in EVE Frontier</p>
                </div>
            </div>
            
            <nav class="nav">
                <a href="index.html" class="nav-link">Home</a>
                <a href="about.html" class="nav-link">About</a>
                <a href="ore-sites.html" class="nav-link">Ore Sites</a>
                <a href="roles.html" class="nav-link">Roles</a>
                <a href="events.html" class="nav-link">Events</a>
                <a href="members.html" class="nav-link">Members</a>
                <a href="logs.html" class="nav-link active">Logs</a>
            </nav>
        </header>

        <main class="main-content">
            <div class="logs-container">
                <div class="logs-header">
                    <h2 class="section-title">📋 Deletion Logs</h2>
                    <p class="section-subtitle">Track all ore site deletions with reasons and character information.</p>
                </div>
                
                <div class="logs-controls">
                    <div class="search-section">
                        <div class="form-group">
                            <label for="logSearch">Search Logs:</label>
                            <input type="text" id="logSearch" class="form-input" placeholder="Search by character name, system, or reason...">
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="form-group">
                            <label for="filterCharacter">Filter by Character:</label>
                            <input type="text" id="filterCharacter" class="form-input" placeholder="Type character name to filter...">
                        </div>
                        
                        <div class="form-group">
                            <label for="filterSystem">Filter by System:</label>
                            <input type="text" id="filterSystem" class="form-input" placeholder="Type system name to filter...">
                        </div>
                        
                        <div class="form-group">
                            <label for="filterDate">Filter by Date:</label>
                            <input type="date" id="filterDate" class="form-input">
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button onclick="loadDeletionLogs()" class="submit-btn">Load Logs</button>
                        <button onclick="clearLogFilters()" class="test-btn">Clear Filters</button>
                        <button onclick="exportLogs()" class="test-btn">Export Logs</button>
                    </div>
                </div>
                
                <div class="logs-stats">
                    <div class="stat-item">
                        <span class="stat-label">Total Deletions:</span>
                        <span class="stat-value" id="totalDeletions">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">This Month:</span>
                        <span class="stat-value" id="monthlyDeletions">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Today:</span>
                        <span class="stat-value" id="todayDeletions">0</span>
                    </div>
                </div>
                
                <div id="deletionLogsList" class="deletion-logs-list">
                    <!-- Deletion logs will be displayed here -->
                </div>
            </div>
        </main>
    </div>

    <style>
        .logs-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .logs-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section-title {
            color: #00d4ff;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-family: 'Orbitron', sans-serif;
        }
        
        .section-subtitle {
            color: #ccc;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .logs-controls {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .search-section {
            margin-bottom: 20px;
        }
        
        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            color: #00d4ff;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(26, 26, 46, 0.9);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            box-sizing: border-box;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            border: none;
            color: #fff;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
        }
        
        .test-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border: none;
            color: #fff;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .logs-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-item {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-label {
            display: block;
            color: #00d4ff;
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .stat-value {
            display: block;
            color: #fff;
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
        }
        
        .deletion-logs-list {
            margin-top: 20px;
        }
        
        .deletion-log-item {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            color: #fff;
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
        }
        
        .log-system {
            font-size: 1.3rem;
            font-weight: 600;
            color: #00d4ff;
        }
        
        .log-date {
            font-size: 0.9rem;
            color: #888;
        }
        
        .log-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .log-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .log-detail-label {
            color: #00d4ff;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        
        .log-detail-value {
            color: #fff;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .log-reason {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .log-reason-label {
            color: #ff6b6b;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .log-reason-text {
            color: #fff;
            font-style: italic;
        }
        
        .no-logs-message {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 40px;
            background: rgba(26, 26, 46, 0.3);
            border-radius: 10px;
        }
        
        @media (max-width: 768px) {
            .filter-section {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .logs-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        // Global variables
        let allDeletionLogs = [];
        let filteredLogs = [];
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Initializing deletion logs system...');
            
            // Set up search and filter inputs
            setupEventListeners();
            
            // Load logs after a short delay
            setTimeout(loadDeletionLogs, 500);
        });
        
        // Set up event listeners for search and filters
        function setupEventListeners() {
            const logSearch = document.getElementById('logSearch');
            const filterCharacter = document.getElementById('filterCharacter');
            const filterSystem = document.getElementById('filterSystem');
            const filterDate = document.getElementById('filterDate');
            
            if (logSearch) {
                logSearch.addEventListener('input', function() {
                    applyFilters();
                });
            }
            
            if (filterCharacter) {
                filterCharacter.addEventListener('input', function() {
                    applyFilters();
                });
            }
            
            if (filterSystem) {
                filterSystem.addEventListener('input', function() {
                    applyFilters();
                });
            }
            
            if (filterDate) {
                filterDate.addEventListener('change', function() {
                    applyFilters();
                });
            }
        }
        
        // Load deletion logs from localStorage
        function loadDeletionLogs() {
            try {
                allDeletionLogs = JSON.parse(localStorage.getItem('trimark_deletion_log') || '[]');
                console.log('✅ Loaded deletion logs:', allDeletionLogs.length);
                
                // Sort by deletion date (newest first)
                allDeletionLogs.sort((a, b) => new Date(b.deletedAt) - new Date(a.deletedAt));
                
                // Apply current filters
                applyFilters();
                
                // Update statistics
                updateLogStatistics();
                
            } catch (error) {
                console.error('❌ Error loading deletion logs:', error);
                allDeletionLogs = [];
                displayDeletionLogs([]);
            }
        }
        
        // Apply all active filters
        function applyFilters() {
            const searchTerm = document.getElementById('logSearch')?.value.toLowerCase() || '';
            const characterFilter = document.getElementById('filterCharacter')?.value.toLowerCase() || '';
            const systemFilter = document.getElementById('filterSystem')?.value.toLowerCase() || '';
            const dateFilter = document.getElementById('filterDate')?.value || '';
            
            filteredLogs = allDeletionLogs.filter(log => {
                let matches = true;
                
                // Search filter (searches across all fields)
                if (searchTerm) {
                    const searchableText = [
                        log.siteSystem || '',
                        log.reason || '',
                        log.deletedBy || '',
                        log.deletedAt || ''
                    ].join(' ').toLowerCase();
                    
                    if (!searchableText.includes(searchTerm)) {
                        matches = false;
                    }
                }
                
                // Character filter
                if (characterFilter && log.deletedBy) {
                    if (!log.deletedBy.toLowerCase().includes(characterFilter)) {
                        matches = false;
                    }
                }
                
                // System filter
                if (systemFilter && log.siteSystem) {
                    if (!log.siteSystem.toLowerCase().includes(systemFilter)) {
                        matches = false;
                    }
                }
                
                // Date filter
                if (dateFilter && log.deletedAt) {
                    const logDate = new Date(log.deletedAt).toISOString().split('T')[0];
                    if (logDate !== dateFilter) {
                        matches = false;
                    }
                }
                
                return matches;
            });
            
            displayDeletionLogs(filteredLogs);
        }
        
        // Display deletion logs in the list
        function displayDeletionLogs(logs) {
            const logsList = document.getElementById('deletionLogsList');
            
            if (!logsList) return;
            
            if (logs.length === 0) {
                logsList.innerHTML = '<div class="no-logs-message">No deletion logs found matching the current filters.</div>';
                return;
            }
            
            const logsHTML = logs.map(log => {
                const deletedDate = new Date(log.deletedAt);
                const formattedDate = deletedDate.toLocaleString();
                const dateOnly = deletedDate.toISOString().split('T')[0];
                
                return `
                    <div class="deletion-log-item">
                        <div class="log-header">
                            <span class="log-system">${log.siteSystem || 'Unknown System'}</span>
                            <span class="log-date">${formattedDate}</span>
                        </div>
                        
                        <div class="log-details">
                            <div class="log-detail-item">
                                <span class="log-detail-label">Deleted By</span>
                                <span class="log-detail-value">${log.deletedBy || 'Unknown Character'}</span>
                            </div>
                            
                            <div class="log-detail-item">
                                <span class="log-detail-label">Site ID</span>
                                <span class="log-detail-value">${log.siteId || 'Unknown'}</span>
                            </div>
                            
                            <div class="log-detail-item">
                                <span class="log-detail-label">Date</span>
                                <span class="log-detail-value">${dateOnly}</span>
                            </div>
                        </div>
                        
                        <div class="log-reason">
                            <div class="log-reason-label">Deletion Reason:</div>
                            <div class="log-reason-text">${log.reason || 'No reason provided'}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            logsList.innerHTML = logsHTML;
        }
        
        // Update log statistics
        function updateLogStatistics() {
            const totalDeletions = document.getElementById('totalDeletions');
            const monthlyDeletions = document.getElementById('monthlyDeletions');
            const todayDeletions = document.getElementById('todayDeletions');
            
            if (!totalDeletions || !monthlyDeletions || !todayDeletions) return;
            
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const today = now.toDateString();
            
            const monthlyCount = allDeletionLogs.filter(log => {
                const logDate = new Date(log.deletedAt);
                return logDate.getMonth() === currentMonth && logDate.getFullYear() === currentYear;
            }).length;
            
            const todayCount = allDeletionLogs.filter(log => {
                const logDate = new Date(log.deletedAt);
                return logDate.toDateString() === today;
            }).length;
            
            totalDeletions.textContent = allDeletionLogs.length;
            monthlyDeletions.textContent = monthlyCount;
            todayDeletions.textContent = todayCount;
        }
        
        // Clear all filters
        function clearLogFilters() {
            document.getElementById('logSearch').value = '';
            document.getElementById('filterCharacter').value = '';
            document.getElementById('filterSystem').value = '';
            document.getElementById('filterDate').value = '';
            
            // Reset to show all logs
            filteredLogs = [...allDeletionLogs];
            displayDeletionLogs(filteredLogs);
        }
        
        // Export logs to JSON file
        function exportLogs() {
            try {
                const dataStr = JSON.stringify(filteredLogs.length > 0 ? filteredLogs : allDeletionLogs, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `deletion-logs-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                console.log('✅ Logs exported successfully');
            } catch (error) {
                console.error('❌ Error exporting logs:', error);
                alert('Error exporting logs. Please try again.');
            }
        }
    </script>
</body>
</html>
