<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trimark Industries - EVE Frontier Portal</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@metamask/detect-provider@2.0.0/dist/detect-provider.min.js"></script>
</head>
<body>
    <div class="stars"></div>
    <div class="twinkling"></div>
    
    <!-- Landing/Authentication Screen -->
    <div id="landingScreen" class="landing-container">
        <div class="landing-content">
            <!-- Logo Section -->
            <div class="landing-logo">
                <img src="ChatGPT_Image_Jul_3_2025_08_34_57_PM.png" alt="Trimark Industries Logo" class="logo-image">
                <h1 class="company-name">TRIMARK INDUSTRIES</h1>
                <p class="company-slogan">Forging the Future in EVE Frontier</p>
            </div>

            <!-- Wallet Connection Section -->
            <div class="wallet-connection-section">
                <h2 class="connection-title">üîí WALLET REQUIRED</h2>
                <p class="connection-description">Connect your wallet to access the Trimark Industries portal</p>
                
                <!-- Connection Status -->
                <div id="connectionStatus" class="connection-status">
                    <div class="status-icon">üîç</div>
                    <div class="status-text">Detecting available wallets...</div>
                </div>

                <!-- Connect Button -->
                <button id="connectWalletBtn" class="connect-wallet-btn" disabled>
                    <span class="btn-icon">üîó</span>
                    <span class="btn-text">Connect Wallet</span>
                </button>

                <!-- Supported Wallets Info -->
                <div class="supported-wallets">
                    <h3>Supported Wallets</h3>
                    <div class="wallet-list">
                        <div class="wallet-item">
                            <span class="wallet-icon">ü¶ä</span>
                            <span class="wallet-name">MetaMask</span>
                        </div>
                        <div class="wallet-item">
                            <span class="wallet-icon">üîë</span>
                            <span class="wallet-name">OneKey</span>
                        </div>
                        <div class="wallet-item">
                            <span class="wallet-icon">‚ö°</span>
                            <span class="wallet-name">Other EIP-6963 Wallets</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading Animation -->
            <div id="loadingAnimation" class="loading-animation hidden">
                <div class="spinner"></div>
                <p>Connecting to wallet...</p>
            </div>

            <!-- Welcome Screen (shown after successful connection) -->
            <div id="welcomeScreen" class="welcome-screen hidden">
                <div class="welcome-content">
                    <div class="welcome-header">
                        <h2>üéâ Welcome to Trimark Industries!</h2>
                    </div>
                    <div class="welcome-body">
                        <div class="welcome-user-info">
                            <img id="welcomeUserPortrait" src="" alt="Character Portrait" class="welcome-portrait">
                            <div class="welcome-user-details">
                                <h3 id="welcomeUserName" class="welcome-user-name">Loading...</h3>
                                <div id="welcomeUserRole" class="welcome-user-role">Loading role...</div>
                            </div>
                        </div>
                        <div class="welcome-message">
                            <p>Welcome back, Commander! You have successfully connected your wallet.</p>
                            <p>Your role: <strong id="welcomeRoleDisplay">Loading...</strong></p>
                            <p>Click the button below to continue to the main site.</p>
                        </div>
                        <button id="continueToSiteBtn" class="continue-btn">
                            <span class="btn-icon">üöÄ</span>
                            <span class="btn-text">Continue to Site</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tribe Verification Screen -->
            <div id="tribeVerificationScreen" class="tribe-verification-screen hidden">
                <div class="tribe-verification-content">
                    <div class="tribe-verification-header">
                        <h2>Access Restricted</h2>
                    </div>
                    <div class="tribe-verification-icon">
                        <span>üö´</span>
                    </div>
                    <div class="tribe-verification-message">
                        <p>You are not a member of the Trimark Industries tribe.</p>
                        <p>Please contact your tribe administrator for access.</p>
                    </div>
                    <button id="retryConnectionBtn" class="retry-btn">
                        <span class="btn-icon">üîÑ</span>
                        <span class="btn-text">Try Again</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application Screen -->
    <div id="mainApp" class="container hidden">
        <header class="header">
            <div class="logo">
                <div class="logo-image">
                    <img src="ChatGPT_Image_Jul_3_2025_08_34_PM.png" alt="Trimark Industries Logo" class="corp-logo">
                </div>
                <div class="logo-text">
                    <h1>TRIMARK INDUSTRIES</h1>
                    <p class="tagline">Forging the Future in EVE Frontier</p>
                </div>
            </div>
            
            <nav class="nav">
                <a href="#/home" class="nav-link active" data-route="home">Home</a>
                <a href="#/about" class="nav-link" data-route="about">About</a>
                <a href="#/ore-sites" class="nav-link" data-route="ore-sites">Ore Sites</a>
                <a href="#/roles" class="nav-link" data-route="roles">Roles</a>
                <a href="#/members" class="nav-link" data-route="members">Members</a>
                <a href="#/events" class="nav-link" data-route="events">Events</a>
                <a href="#/logs" class="nav-link" data-route="logs">Logs</a>
                <a href="#/security" class="nav-link" data-route="security">Security</a>
                <a href="#/logistics" class="nav-link" data-route="logistics">Logistics</a>
                <a href="#/manufacturing" class="nav-link" data-route="manufacturing">Manufacturing</a>
            </nav>

            <div class="wallet-section">
                <button id="connectWallet" class="wallet-btn">
                    <span class="wallet-icon">üîó</span>
                    Connect Wallet
                </button>

                <div id="userProfile" class="user-profile hidden">
                    <img id="userPortrait" src="" alt="Character Portrait" class="user-portrait">
                    <div class="user-info">
                        <span id="userName" class="user-name"></span>
                        <span id="userAddress" class="user-address"></span>
                    </div>
                    <button id="disconnectWallet" class="disconnect-btn">√ó</button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="mainContent" class="main-content">
            <!-- Content will be dynamically loaded here -->
        </main>

        <!-- Hidden Canvas Element for The Architect's Signature -->
        <canvas id="hiddenCanvas" width="100" height="100" style="display: none; position: absolute; left: -9999px; top: -9999px; width: 0; height: 0;"></canvas>

        <!-- Admin Panel Modal -->
        <div id="adminPanelModal" class="admin-modal hidden">
            <div class="admin-modal-content">
                <div class="admin-modal-header">
                    <h2>üîê Admin Panel</h2>
                    <button id="closeAdminModal" class="close-btn">√ó</button>
                </div>
                <div class="admin-modal-body">
                    <div class="admin-section">
                        <h3>üë• User Management</h3>
                        <div class="admin-controls">
                            <input type="text" id="userSearchInput" placeholder="Search users..." class="admin-input">
                            <button id="addUserBtn" class="admin-btn">Add New User</button>
                            <button id="addAdminBtn" class="admin-btn" style="background: linear-gradient(135deg, #ffd700, #ffb347); color: #333;">üëë Add Admin</button>
                            <button id="editContentBtn" class="admin-btn" style="background: linear-gradient(135deg, #ff6b6b, #ff4757);">‚úèÔ∏è Edit Content</button>
                        </div>
                        <div class="users-list-container">
                            <div id="usersList" class="users-list">
                                <!-- Users will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-section">
                        <h3>üìä Statistics</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">Total Users</span>
                                <span id="totalUsers" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Active Users</span>
                                <span id="activeUsers" class="stat-value">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-section">
                        <h3>üîç Recent Activity</h3>
                        <div id="recentActivity" class="activity-log">
                            <p class="no-activity">No recent activity</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add User Modal -->
        <div id="addUserModal" class="admin-modal hidden">
            <div class="admin-modal-content">
                <div class="admin-modal-header">
                    <h2>‚ûï Add New User</h2>
                    <button id="closeAddUserModal" class="close-btn">√ó</button>
                </div>
                <div class="admin-modal-body">
                    <div class="admin-section">
                        <div class="admin-controls">
                            <input type="text" id="newUserAddress" placeholder="Enter wallet address" class="admin-input">
                            <button id="confirmAddUserBtn" class="admin-btn">Add User</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Admin Modal -->
        <div id="addAdminModal" class="add-admin-modal hidden">
            <div class="add-admin-modal-content">
                <h3>üëë Add New Admin</h3>
                <input type="text" id="newAdminAddress" placeholder="Enter wallet address for new admin">
                <div class="add-admin-modal-buttons">
                    <button id="confirmAddAdminBtn" class="confirm-btn">Add Admin</button>
                    <button id="closeAddAdminModal" class="cancel-btn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Page Templates -->
    <template id="homeTemplate">
        <div class="home-content">
            <section class="hero-section">
                <h2>Welcome to Trimark Industries</h2>
                <p>Your gateway to EVE Frontier excellence</p>
            </section>
            
            <section class="quick-stats">
                <div class="stat-card">
                    <h3>Active Members</h3>
                    <p id="activeMembersCount">Loading...</p>
                </div>
                <div class="stat-card">
                    <h3>Ore Sites</h3>
                    <p id="oreSitesCount">Loading...</p>
                </div>
                <div class="stat-card">
                    <h3>Recent Events</h3>
                    <p id="recentEventsCount">Loading...</p>
                </div>
            </section>
        </div>
    </template>

    <template id="aboutTemplate">
        <div class="about-content">
            <h2>About Trimark Industries</h2>
            <p>We are a premier corporation in EVE Frontier, dedicated to excellence in mining, manufacturing, and strategic operations.</p>
            <!-- Add more about content as needed -->
        </div>
    </template>

    <template id="oreSitesTemplate">
        <div class="ore-sites-content">
            <h2>Ore Sites</h2>
            <div id="oreSitesList">
                <!-- Ore sites will be populated here -->
            </div>
        </div>
    </template>

    <template id="rolesTemplate">
        <div class="roles-content">
            <h2>Roles & Permissions</h2>
            <div id="rolesList">
                <!-- Roles will be populated here -->
            </div>
        </div>
    </template>

    <template id="membersTemplate">
        <div class="members-content">
            <section id="members" class="members-section">
                <h2 class="section-title">Tribe Members</h2>
                <div class="members-content">
                    <div class="members-header">
                        <div class="members-info">
                            <h3>Trimark Industries Members</h3>
                            <p>Complete roster of all active tribe members, their join dates, and time in service.</p>
                        </div>
                        <div class="members-controls">
                            <div class="member-count">
                                Total Members: <span id="totalMemberCount" style="color: #00d4ff; font-weight: bold;">0</span>
                            </div>
                            <button onclick="refreshTribeMembers()" class="member-btn secondary">
                                üîÑ Refresh Members
                            </button>
                        </div>
                    </div>
                    
                    <div class="members-list-container">
                        <div class="members-filters">
                            <input type="text" id="memberSearchInput" placeholder="Search members by name..." class="member-search-input">
                            <select id="memberSortSelect" class="member-sort-select">
                                <option value="name">Sort by Name</option>
                                <option value="joinDate">Sort by Join Date</option>
                                <option value="timeInTribe">Sort by Time in Tribe</option>
                            </select>
                        </div>
                        
                        <div id="membersList" class="members-list">
                            <!-- Members will be populated here -->
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </template>

    <template id="eventsTemplate">
        <div class="events-content">
            <h2>Upcoming Events</h2>
            <div id="eventsList">
                <!-- Events will be populated here -->
            </div>
        </div>
    </template>

    <template id="logsTemplate">
        <div class="logs-content">
            <h2>Activity Logs</h2>
            <div id="logsList">
                <!-- Logs will be populated here -->
            </div>
        </div>
    </template>

    <template id="securityTemplate">
        <div class="security-content">
            <h2>Security Dashboard</h2>
            <div id="securityInfo">
                <!-- Security information will be populated here -->
            </div>
        </div>
    </template>

    <template id="logisticsTemplate">
        <div class="logistics-content">
            <h2>Logistics Management</h2>
            <div id="logisticsInfo">
                <!-- Logistics information will be populated here -->
            </div>
        </div>
    </template>

    <template id="manufacturingTemplate">
        <div class="manufacturing-content">
            <h2>Manufacturing Operations</h2>
            <div id="manufacturingInfo">
                <!-- Manufacturing information will be populated here -->
            </div>
        </div>
    </template>

    <script src="script.js"></script>
    <script>
        // SPA Router and Application Logic
        class TrimarkSPA {
            constructor() {
                this.currentRoute = 'home';
                this.routes = {
                    'home': 'homeTemplate',
                    'about': 'aboutTemplate',
                    'ore-sites': 'oreSitesTemplate',
                    'roles': 'rolesTemplate',
                    'members': 'membersTemplate',
                    'events': 'eventsTemplate',
                    'logs': 'logsTemplate',
                    'security': 'securityTemplate',
                    'logistics': 'logisticsTemplate',
                    'manufacturing': 'manufacturingTemplate'
                };
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.checkAuthentication();
                this.setupRouting();
            }

            setupEventListeners() {
                // Navigation event listeners
                document.addEventListener('click', (e) => {
                    if (e.target.matches('.nav-link')) {
                        e.preventDefault();
                        const route = e.target.getAttribute('data-route');
                        if (route) {
                            this.navigateTo(route);
                        }
                    }
                });

                // Hash change listener
                window.addEventListener('hashchange', () => {
                    this.handleRouteChange();
                });
            }

            checkAuthentication() {
                const walletConnected = localStorage.getItem('walletConnected');
                const walletAccount = localStorage.getItem('walletAccount');
                
                if (walletConnected && walletAccount) {
                    this.showMainApp();
                } else {
                    this.showLanding();
                }
            }

            showLanding() {
                document.getElementById('landingScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }

            showMainApp() {
                document.getElementById('landingScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                this.handleRouteChange();
            }

            setupRouting() {
                // Handle initial route
                if (window.location.hash) {
                    this.handleRouteChange();
                } else {
                    // Default to home
                    window.location.hash = '#/home';
                }
            }

            handleRouteChange() {
                const hash = window.location.hash;
                const route = hash.replace('#/', '') || 'home';
                
                if (this.routes[route]) {
                    this.navigateTo(route);
                } else {
                    this.navigateTo('home');
                }
            }

            navigateTo(route) {
                this.currentRoute = route;
                
                // Update navigation active state
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                const activeLink = document.querySelector(`[data-route="${route}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }

                // Load content
                this.loadContent(route);
                
                // Update URL without page reload
                if (window.location.hash !== `#/${route}`) {
                    window.location.hash = `#/${route}`;
                }
            }

            loadContent(route) {
                const templateId = this.routes[route];
                const template = document.getElementById(templateId);
                const mainContent = document.getElementById('mainContent');
                
                if (template) {
                    mainContent.innerHTML = template.innerHTML;
                    this.initializePageContent(route);
                }
            }

            initializePageContent(route) {
                // Initialize specific page functionality
                switch (route) {
                    case 'home':
                        this.initializeHomePage();
                        break;
                    case 'ore-sites':
                        this.initializeOreSitesPage();
                        break;
                    case 'members':
                        this.initializeMembersPage();
                        break;
                    // Add other page initializations as needed
                }
            }

            initializeHomePage() {
                // Initialize home page specific functionality
                console.log('Home page initialized');
            }

            initializeOreSitesPage() {
                // Initialize ore sites page specific functionality
                console.log('Ore sites page initialized');
            }

            initializeMembersPage() {
                // Initialize members page specific functionality
                console.log('Members page initialized');
                
                // Trigger the existing JavaScript functionality
                if (typeof refreshTribeMembers === 'function') {
                    console.log('üîÑ Triggering tribe members refresh...');
                    refreshTribeMembers();
                } else {
                    console.log('‚ö†Ô∏è refreshTribeMembers function not found, waiting for script.js to load...');
                    // Wait a bit for script.js to fully initialize
                    setTimeout(() => {
                        if (typeof refreshTribeMembers === 'function') {
                            console.log('üîÑ Retrying tribe members refresh...');
                            refreshTribeMembers();
                        } else {
                            console.error('‚ùå refreshTribeMembers function still not available');
                        }
                    }, 1000);
                }
            }
        }

        // Initialize the SPA when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.trimarkSPA = new TrimarkSPA();
        });
    </script>
</body>
</html>
